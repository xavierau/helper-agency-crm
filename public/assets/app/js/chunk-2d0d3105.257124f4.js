(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d3105"],{"5abe":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"OrganizationIndex"},[a("CCard",[a("CCardHeader",{staticClass:"d-flex justify-content-between align-content-center"},[a("h5",{staticClass:"m-0"},[t._v("Organizations")]),a("button",{staticClass:"btn btn-sm btn-success",on:{click:function(e){t.showCreateModal=!t.showCreateModal}}},[a("i",{staticClass:"fa fa-plus"}),t._v(" Organization ")])]),t.items?a("CCardBody",[a("organization-tree-diagram",{staticStyle:{height:"300px"},attrs:{organizations:t.items}}),a("CDataTable",{attrs:{items:t.items,fields:t.fields,loading:t.isLoading,hover:"","items-per-page":15,"column-filter":"","table-filter":"",sorter:""},scopedSlots:t._u([{key:"parent.label",fn:function(e){var n=e.item;return[a("td",[t._v(" "+t._s(n.parent?n.parent.label:"none")+" ")])]}},{key:"actions",fn:function(e){var n=e.item;return[a("td",[a("button",{staticClass:"btn btn-sm btn-icon btn-info",on:{click:function(e){return t.editOrg(n)}}},[a("i",{staticClass:"fa fa-edit"})]),a("button",{staticClass:"ml-1 btn btn-sm btn-icon btn-danger",on:{click:function(e){return t.destroy(n)}}},[a("i",{staticClass:"far fa-trash-alt"})])])]}}],null,!1,2745827860)})],1):a("CCardBody",[a("h4",[t._v("Loading...")])])],1),a("CModal",{attrs:{show:t.showCreateModal,title:"Create New Organization",color:"success",static:"",size:"xl"},on:{"update:show":function(e){t.showCreateModal=e}},scopedSlots:t._u([{key:"footer",fn:function(){return[a("button",{staticClass:"btn btn-success",on:{click:t.submit}},[t._v("Create")])]},proxy:!0}])},[a("form",{staticClass:"form"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"label"}},[t._v("Organization Label")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.label,expression:"formData.label"}],staticClass:"form-control",attrs:{type:"text",id:"label"},domProps:{value:t.formData.label},on:{input:function(e){e.target.composing||t.$set(t.formData,"label",e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"parent"}},[t._v("Parent Organization")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.formData.parent_id,expression:"formData.parent_id"}],staticClass:"form-control",attrs:{type:"text",id:"parent"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.formData,"parent_id",e.target.multiple?a:a[0])}}},[a("option",{domProps:{value:null}},[t._v("No parent organization")]),t._l(t.items,(function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.label))])}))],2)])])]),a("CModal",{attrs:{show:t.showUpdateModal,title:"Create New Organization",color:"success",static:"",size:"xl"},on:{"update:show":function(e){t.showUpdateModal=e}},scopedSlots:t._u([{key:"footer",fn:function(){return[a("button",{staticClass:"btn btn-success",on:{click:t.update}},[t._v("Update")])]},proxy:!0}])},[t.selected_organization?a("form",{staticClass:"form"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"selected_label"}},[t._v("Organization Label")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.selected_organization.label,expression:"selected_organization.label"}],staticClass:"form-control",attrs:{type:"text",id:"selected_label"},domProps:{value:t.selected_organization.label},on:{input:function(e){e.target.composing||t.$set(t.selected_organization,"label",e.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"selected_parent_org"}},[t._v("Parent Organization")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.selected_organization.parent_id,expression:"selected_organization.parent_id"}],staticClass:"form-control",attrs:{type:"text",id:"selected_parent_org"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.selected_organization,"parent_id",e.target.multiple?a:a[0])}}},[a("option",{domProps:{value:null}},[t._v("No parent organization")]),t._l(t.items,(function(e){return a("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.label))])}))],2)])]):t._e()])],1)},o=[],r={list:"/api/organizations",store:"/api/organizations",update:function(t){return"/api/organizations/".concat(t)},delete:function(t){return"/api/organizations/".concat(t)}},i=r,s=a("7ed9"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"cy"})},c=[],u=a("44e1"),d=a.n(u),f=a("b17d"),p=a.n(f);d.a.use(p.a);var m={name:"OrganizationTreeDiagram",props:{organizations:{type:Array,required:!0}},watch:{organizations:function(){this.draw()}},mounted:function(){this.draw()},methods:{draw:function(){var t=this.organizations.map((function(t){return{data:{id:"o_".concat(t.id),label:t.label}}})),e=this.organizations.filter((function(t){return null!==t.parent})).map((function(t){return{data:{id:"l_".concat(t.id),label:t.label,source:t.parent?"o_".concat(t.parent.id):null,target:"o_".concat(t.id)}}})),a=t.concat(e);d()({container:this.$refs.cy,elements:a,style:[{selector:"node",style:{height:10,width:10,"font-size":"6px","background-color":"#1e4df3",label:"data(label)"}},{selector:"edge",style:{"font-size":"5px",width:2,"line-color":"#ccc","target-arrow-color":"#ccc","target-arrow-shape":"triangle","curve-style":"bezier"}}],layout:{name:"dagre"}})}}},g=m,b=a("2877"),v=Object(b["a"])(g,l,c,!1,null,"4fe9070d",null),_=v.exports,h={name:"OrganizationIndex",components:{OrganizationTreeDiagram:_},data:function(){return{showCreateModal:!1,showUpdateModal:!1,isLoading:!0,selected_organization:null,entity:null,items:null,fields:[{key:"label"},{key:"parent.label"},{key:"actions",sorter:!1,filter:!1}],formData:{label:null,parent_id:null}}},created:function(){var t=this;s["a"].get(i.list).then((function(e){var a=e.data;return t.items=a||[]})).then((function(){return t.isLoading=!1}))},methods:{getParentLabel:function(t){var e=this.items.find((function(e){return e.id===t.parent_id}));return e?e.label:null},editOrg:function(t){this.selected_organization={id:t.id,label:t.label,parent_id:t.parent?t.parent.id:null},this.showUpdateModal=!0},submit:function(){var t=this;s["a"].post(i.store,this.formData).then((function(e){var a=e.data;return t.items.push(a)})).then((function(){return t.$toasted.success("New organization created!")})).then((function(){return t.formData={label:null,parent_id:null}})).then((function(){return t.showCreateModal=!1}))},update:function(){var t=this;s["a"].put(i.update(this.selected_organization.id),this.selected_organization).then((function(e){var a=e.data;return t.items=t.items.map((function(t){return t.id===a.id?a:t}))})).then((function(){return t.$toasted.success("Organization updated!")})).then((function(){return t.selected_organization=null})).then((function(){return t.showUpdateModal=!1}))},destroy:function(t){var e=this;s["a"].delete(i.delete(t.id)).then((function(t){var a=t.data;return e.items=e.items.filter((function(t){return t.id!==a.id}))})).then((function(){return e.$toasted.success("Organization deleted!")}))}}},z=h,C=Object(b["a"])(z,n,o,!1,null,"719afc76",null);e["default"]=C.exports}}]);